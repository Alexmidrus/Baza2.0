{% extends "base.html" %}
{% block title %}Вход — Админ-панель{% endblock %}

{% block body %}
<main class="mx-auto max-w-6xl px-4 py-10">
  <div class="grid lg:grid-cols-12 gap-6 items-stretch">
    <!-- Left branding -->
    <section class="lg:col-span-7 rounded-3xl border border-gray-200 bg-white shadow-soft overflow-hidden">
      <div class="relative h-64 sm:h-80 lg:h-full min-h-[420px]">
        <div class="absolute inset-0 ph"></div>
        <div class="absolute inset-0 bg-gradient-to-t from-slate-900/60 via-slate-900/10 to-transparent"></div>

        <div class="absolute top-6 left-6 flex items-center gap-2">
          <div class="h-10 w-10 rounded-2xl bg-white/90 border border-white/40 grid place-items-center">
            <span class="font-display font-extrabold text-brand-600">Ж</span>
          </div>
          <div class="text-white">
            <div class="font-display font-extrabold text-lg leading-tight">Жемчужина</div>
            <div class="text-white/80 text-sm -mt-0.5">админ-панель</div>
          </div>
        </div>

        <div class="absolute bottom-6 left-6 right-6">
          <h1 class="font-display text-3xl sm:text-4xl font-extrabold text-white tracking-tight">
            Управление сайтом
          </h1>
          <p class="mt-2 text-white/90 max-w-xl">
            Домики, беседки, цены и видимость на сайте — в одном месте.
          </p>
        </div>
      </div>
    </section>

    <!-- Login card -->
    <section class="lg:col-span-5 rounded-3xl border border-gray-200 bg-white shadow-soft p-6 sm:p-7">
      <div class="flex items-start justify-between gap-4">
        <div>
          <h2 class="font-display text-2xl font-extrabold">Вход</h2>
          <p class="text-sm text-slate-600 mt-1">Введите логин и пароль администратора.</p>
        </div>
        <div class="h-10 w-10 rounded-2xl bg-brand-50 border border-gray-200 grid place-items-center">
          <svg viewBox="0 0 24 24" class="h-5 w-5 text-slate-900" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4Z"/>
            <path d="M20 21a8 8 0 0 0-16 0"/>
          </svg>
        </div>
      </div>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mt-4 grid gap-2">
            {% for category, msg in messages %}
              <div class="rounded-2xl border border-gray-200 bg-slate-50 px-4 py-3 text-sm text-slate-800">
                {{ msg }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <form class="mt-6 grid gap-3" method="post" action="{{ url_for('admin_login_post') }}">
        <label class="grid gap-1">
          <span class="text-xs font-semibold text-slate-800">Логин</span>
          <input name="username" required type="text" placeholder="admin"
            class="h-11 rounded-xl border border-gray-200 px-3 outline-none focus:ring-4 focus:ring-brand-50 focus:border-brand-500">
        </label>

        <label class="grid gap-1">
          <span class="text-xs font-semibold text-slate-800">Пароль</span>
          <input name="password" required type="password" placeholder="••••••••"
            class="h-11 rounded-xl border border-gray-200 px-3 outline-none focus:ring-4 focus:ring-brand-50 focus:border-brand-500">
        </label>

        <div class="flex items-center justify-end pt-1">
          <button type="button" id="forgotBtn" class="text-sm font-semibold text-brand-600 hover:text-brand-600/80">
            Забыли пароль?
          </button>
        </div>

        <button class="mt-2 h-12 rounded-xl bg-brand-500 text-white font-semibold hover:bg-brand-600">
          Войти
        </button>

        <p class="text-xs text-slate-500 mt-2">
          Доступ только для сотрудников базы отдыха.
        </p>
      </form>
    </section>
  </div>
</main>

<!-- Forgot password modal -->
<div id="modal" class="fixed inset-0 hidden items-center justify-center bg-slate-900/40 p-4">
  <div class="w-full max-w-md rounded-3xl border border-gray-200 bg-white shadow-soft p-6">
    <div class="flex items-start justify-between gap-4">
      <div>
        <h3 class="font-display text-xl font-extrabold">Восстановление пароля</h3>
        <p class="text-sm text-slate-600 mt-1">Укажите email, мы отправим инструкции.</p>
      </div>
      <button id="modalClose" class="h-10 w-10 rounded-xl border border-gray-200 grid place-items-center hover:bg-slate-50" aria-label="Закрыть">
        <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 6l12 12M18 6L6 18"/>
        </svg>
      </button>
    </div>

    <form class="mt-5 grid gap-3" method="post" action="{{ url_for('admin_reset_password') }}">
      <label class="grid gap-1">
        <span class="text-xs font-semibold text-slate-800">Email</span>
        <input name="email" id="resetEmail" type="email" required placeholder="admin@site.ru"
          class="h-11 rounded-xl border border-gray-200 px-3 outline-none focus:ring-4 focus:ring-brand-50 focus:border-brand-500">
      </label>

      <button class="h-12 rounded-xl bg-brand-500 text-white font-semibold hover:bg-brand-600">
        Отправить письмо
      </button>
    </form>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  const forgotBtn = document.getElementById('forgotBtn');
  const modal = document.getElementById('modal');
  const modalClose = document.getElementById('modalClose');

  function openModal() {
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    setTimeout(() => document.getElementById('resetEmail').focus(), 0);
  }
  function closeModal() {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
  }

  forgotBtn?.addEventListener('click', openModal);
  modalClose?.addEventListener('click', closeModal);
  modal?.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
</script>
{% endblock %}
